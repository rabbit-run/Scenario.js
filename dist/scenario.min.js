/* Scenario.js v1.0.0
 * The MIT License (MIT)
 * Copyright (c) 2014 Maker Studios */
(function(a,b){"use strict";var c="Scenario",d=90,e=e||function(a){function c(a,b,c){a=a.replace(/\s+/g,"_");var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+"; "+e}function e(a){a=a.replace(/\s+/g,"_");for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1);if(-1!==e.indexOf(b))return e.substring(b.length,e.length)}return""}a.track=a.track||function(a,b,c){return"undefined"!=typeof mixpanel?mixpanel.track(a,b,c):void 0};var f,g=this;g.cache={ranTests:{},weights:{},totalWeights:0},g.tests={},f={track:a.track,toSlug:function(a){return a.toLowerCase().replace(/-+/g,"").replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")},chooseTest:function(){var b,c=(a.name,this.previousAssignedTest());return c?b=c:(b=this.chooseWeightedItem(),this.persistChosenTest(b)),b},persistChosenTest:function(b){"undefined"!=typeof b&&c(a.name,b,d)},previousAssignedTest:function(){return e(a.name)},chooseWeightedItem:function(){var a,b=[];for(a in g.cache.weights)for(var c=g.cache.weights[a];c--;)b.push(parseInt(a,10));return b[Math.floor(Math.random()*b.length)]}},g.test=function(b){b.weight=b.weight||1;var c=g.tests[a.name].length;return g.tests[a.name].push({name:b.name,callback:b.callback,weight:b.weight,className:b.className||f.toSlug(b.name)}),g.cache.weights[c]=b.weight,g.cache.totalWeights+=b.weight,this},g.go=function(){var c=f.chooseTest(),d=g.tests[a.name][c];return b.body.className+=" "+d.className,g.cache.ranTests[a.name]=d.name,f.track(a.name+" Start",{Tests:d.name}),"function"==typeof d.callback&&d.callback.call(null,{name:d.name,slug:d.className,weight:d.weight+"/"+g.cache.totalWeights,odds:Math.floor(d.weight/g.cache.totalWeights*100)}),this},g.complete=function(b){return f.track(a.name+" Finish",null,b)},g.tests[a.name]=g.tests[a.name]||[]};this[c]=e}).call(this,window,document);Scenario.version='1.0.0';